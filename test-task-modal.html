<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Modal Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Simulate session variables
        window.userRole = 'admin';
        window.userId = 1;
        window.userName = 'Test User';
    </script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-2xl mx-auto">
        <h1 class="text-3xl font-bold mb-8">üß™ Task Modal Test Page</h1>
        
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Session Info</h2>
            <div class="grid grid-cols-3 gap-4 text-sm">
                <div><strong>User ID:</strong> <span id="userId"></span></div>
                <div><strong>User Role:</strong> <span id="userRole"></span></div>
                <div><strong>User Name:</strong> <span id="userName"></span></div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Test Buttons</h2>
            <div class="space-y-4">
                <button onclick="testGlobalTaskManager()" 
                        class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors block w-full">
                    Test Global Task Manager Existence
                </button>
                
                <button onclick="testLoadUsers()" 
                        class="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition-colors block w-full">
                    Test Load Users API
                </button>
                
                <button onclick="globalTaskManager.openAddTaskModal()" 
                        class="bg-purple-500 text-white px-6 py-3 rounded-lg hover:bg-purple-600 transition-colors block w-full">
                    üéØ Open Add Task Modal (globalTaskManager)
                </button>
                
                <button onclick="window.globalTaskManager.openAddTaskModal()" 
                        class="bg-indigo-500 text-white px-6 py-3 rounded-lg hover:bg-indigo-600 transition-colors block w-full">
                    üéØ Open Add Task Modal (window.globalTaskManager)
                </button>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">Console Output</h2>
            <div id="output" class="bg-gray-100 p-4 rounded text-sm font-mono h-64 overflow-y-auto"></div>
        </div>
    </div>

    <script src="assets/js/global-task-manager.js"></script>
    
    <script>
        // Update session info display
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('userId').textContent = window.userId;
            document.getElementById('userRole').textContent = window.userRole;
            document.getElementById('userName').textContent = window.userName;
        });

        // Capture console logs
        const outputDiv = document.getElementById('output');
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        
        function addToOutput(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.className = type === 'error' ? 'text-red-600' : type === 'warn' ? 'text-yellow-600' : 'text-gray-800';
            div.textContent = `[${timestamp}] ${message}`;
            outputDiv.appendChild(div);
            outputDiv.scrollTop = outputDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToOutput(args.join(' '), 'log');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToOutput(args.join(' '), 'warn');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToOutput(args.join(' '), 'error');
        };

        function testGlobalTaskManager() {
            console.log('=== Testing Global Task Manager ===');
            console.log('window.globalTaskManager exists:', typeof window.globalTaskManager !== 'undefined');
            console.log('globalTaskManager exists:', typeof globalTaskManager !== 'undefined');
            
            if (window.globalTaskManager) {
                console.log('‚úÖ Global Task Manager is available');
                console.log('Users count:', window.globalTaskManager.users.length);
                console.log('Can create tasks:', window.globalTaskManager.canCreateTasks());
                console.log('Is ready:', window.globalTaskManager.isReady());
            } else {
                console.error('‚ùå Global Task Manager not found');
            }
        }

        async function testLoadUsers() {
            console.log('=== Testing Load Users ===');
            if (window.globalTaskManager) {
                try {
                    await window.globalTaskManager.loadUsers(true);
                    console.log('‚úÖ Load users completed');
                } catch (error) {
                    console.error('‚ùå Load users failed:', error);
                }
            } else {
                console.error('‚ùå Global Task Manager not available');
            }
        }
    </script>
</body>
</html>